<!--+ Warning: Content inside HTML comment blocks was generated by mdat and may be overwritten. +-->

# ItsOn

<!-- badges -->

[![NPM Package itson](https://img.shields.io/npm/v/itson.svg)](https://npmjs.com/package/itson)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

<!-- /badges -->

<!-- short-description -->

**A CLI tool for configuration-driven management of long-running interactive applications.**

<!-- /short-description -->

> [!WARNING]
>
> Itson is under development. It should not be considered suitable for general use until a 1.0 release.

## Overview

Itson helps you install, update, and run your bespoke privately-distributed applications in the context of long-running interactive installations or exhibits.

Itson does the following each time it runs:

1. **Read** a configuration file and **register** any new configuration settings with the operating system. \
   _For now, this amounts to scheduling itson's own launch on future startups._

2. **Check** for available updates to exhibit applications, prompting for credentials if necessary. \
   _For now, this is limited to checking for new releases on GitHub, and follows [semver](https://semver.org/) rules. The latest release is selected by default, or a semver-compatible version constraint or range may be specified in the application's configuration. GitHub credentials are requested interactively as needed and securely stored for subsequent use._

3. **Download** and **install** updates if available. \
   _For now, this means standalone pre-built `.exe` binaries or `.app` bundles provided as assets attached to GitHub releases, or `uv tool`-installable Python application packages hosted in GitHub repositories._

4. **Upload** log files. \
   _For now, this means syncing a folder of log files to an S3-compatible object storage bucket for each application. S3 credentials are requested interactively as needed and then securely stored in the system keychain for subsequent use._

5. **Start** exhibit application(s) using the system-level services framework, and keep them running if they're closed or crash. \
   _For now, this leverages `launchd` on macOS._

## Getting started

### Dependencies

Itson is architected with future cross-platform support in mind, but currently only provides implementations for macOS.

Itson requires [Node](https://nodejs.org/) 22.12.0+.

Installing Python application packages requires [uv](https://docs.astral.sh/uv/).

### Installation

```sh
npm install --global itson
```

## Usage

Create a configuration file as described below, and then invoke `itson` to update the system to reflect your configuration, check for and install any application updates, and then immediately launch any specified applications.

This command runs automatically at system startup when `runOnStartup: true` in your configuration.

### Configuration

Create an `itson.config.js` file in your home directory.

```js
export default {
  applications: [
    {
      command: '/Applications/AllWork.app/Contents/MacOS/AllWork',
      name: 'AllWork',
      update: {
        artifactPattern: /^AllWork.+\.zip$/,
        destination: '/Applications/AllWork.app',
        owner: 'kitschpatrol',
        repo: 'allwork',
        type: 'github',
      },
    },
    {
      command: 'interpose',
      name: 'Interpose',
    },
  ],
  runOnStartup: true,
}
```

An optional `update` strategy may be specified.

Currently, only updates from GitHub releases containing Python application packages or attached binary artifacts are supported.

Private GitHub repositories are supported via personal access tokens bearing at least the `contents:read` and `metadata:read` permissions.

### Commands

<!-- cli-help {depth: 1} -->

#### Command: `itson`

Run an itson command.

If no command is provided, `itson launch` is run by default.

Usage:

```txt
itson [command]
```

| Command    | Description                                                                                                               |
| ---------- | ------------------------------------------------------------------------------------------------------------------------- |
| `launch`   | Update, register, and start all managed applications. Applications will auto-restart if they crash. _(Default command.)_  |
| `start`    | Start all managed applications. Applications will auto-restart if they crash.                                             |
| `stop`     | Stop all managed applications.                                                                                            |
| `update`   | Update all managed applications to the latest available versions.                                                         |
| `register` | Register itson with the system according to the config file. Optionally run this after changing state in the config file. |
| `reset`    | Clear any credentials stored in the system keychain, and remove any registered services.                                  |

| Option              | Description              | Type      |
| ------------------- | ------------------------ | --------- |
| `--verbose`         | Run with verbose logging | `boolean` |
| `--help`<br>`-h`    | Show help                | `boolean` |
| `--version`<br>`-v` | Show version number      | `boolean` |

<!-- /cli-help -->

## Background

### Alternatives

#### Monitoring / scheduling

- [AMPM](https://github.com/stimulant/ampm)
- [PM2](https://pm2.keymetrics.io/)

#### Updates / deployment

Update functionality can be baked into applications (e.g. [Squirrel](https://github.com/Squirrel), [Sparkle](https://sparkle-project.org/), [Electron autoUpdater](https://www.electronjs.org/docs/latest/api/auto-updater), etc.), but these are geared toward end-user applications and generally display their prompts interactively — unworkable for an "always up" interactive exhibit application.

[Homebrew](https://brew.sh) or [Scoop](https://scoop.sh/) implement robust and readily-scriptable package management solutions, but none are (practically) cross-platform. Securing and managing private registries for one-off applications is a bit of a pain.

[Docker](https://www.docker.com/) and other containerization strategies can be appealing on the back-end. For highly interactive real-time graphical applications, containerization creates extra hoops to jump through to access specialized low-level hardware, GPUs, and audio devices.

### Scope

Itson is responsible for the following:

- Updating exhibit application software non-interactively
- Securely storing credentials required for updates
- Ensuring that exhibit application software restarts automatically in the event of a crash
- Uploading log files to S3

Itson is currently **not** concerned with the following:

- Scheduling
- Automatic rollback

### Development notes

Itson itself is not a long-running process. It runs once at startup, and then hands over responsibility for application monitoring to the operating system's native service-management facilities.

Native implementations are used wherever possible (e.g. launchd for process management, the system keychain for credential storage.)

#### Launchd

- [svcinstall](https://github.com/bryanmacfarlane/svcinstall) (cross-platform)
- [npm-launchctl-helper](https://github.com/alex-kostirin/npm-launchctl-helper)
- [launchd.info](https://launchd.info/)
- Agents: `~/Library/LaunchAgents/`
- Logs: `/tmp/`

#### Keychain

- [keytar-forked](https://github.com/shiftkey/node-keytar)
- [node-keytar](https://github.com/makeproaudio/node-keytar)

## Maintainers

[@kitschpatrol](https://github.com/kitschpatrol)

<!-- contributing -->

## Contributing

[Issues](https://github.com/kitschpatrol/itson/issues) and pull requests are welcome.

<!-- /contributing -->

<!-- license -->

## License

[MIT](license.txt) © Eric Mika

<!-- /license -->
